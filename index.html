<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memento Mori</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect width='16' height='16' fill='%23c0392b'/></svg>">
    <style>
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            background: #0a0a0a;
            color: #d4d4d4;
            font-family: 'Times New Roman', 'Georgia', serif;
            min-height: 100vh;
        }

        /* ============================
           FIRST PART — Info Panel
           ============================ */

        .info-panel {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #0a0a0a;
            text-align: center;
            padding: 14px 20px 12px;
            border-bottom: 1px solid #161616;
        }

        .info-panel h1 {
            font-family: 'Times New Roman', serif;
            font-size: 1.6rem;
            font-weight: 400;
            letter-spacing: 0.35em;
            text-transform: uppercase;
            color: #e0e0e0;
            margin-bottom: 6px;
        }

        .dates {
            font-size: 0.8rem;
            color: #555;
            letter-spacing: 0.15em;
            margin-bottom: 10px;
        }

        .separator {
            width: 30px;
            height: 1px;
            background: #2a2a2a;
            margin: 0 auto 10px;
        }

        .clock {
            font-variant-numeric: tabular-nums;
        }

        .clock .value {
            font-size: 1rem;
            color: #c8c8c8;
        }

        .clock .unit {
            font-size: 0.6rem;
            color: #3e3e3e;
            margin: 0 8px 0 2px;
            letter-spacing: 0.1em;
        }

        /* ============================
           SECOND PART — Day Grid
           ============================ */

        .grid-section {
            display: flex;
            justify-content: center;
            padding: 0 20px 120px;
        }

        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1px;
            max-width: 882px; /* ~98 squares per row at 9px pitch */
        }

        .day {
            width: 8px;
            height: 8px;
            cursor: crosshair;
            transition: transform 0.12s ease;
        }

        .day:hover {
            transform: scale(2.5);
            z-index: 10;
            position: relative;
        }

        /* Lived days — dimmed fill on dark background */
        .day.lived {
            background: #999;
            opacity: 0.6;
        }

        .day.lived:hover {
            background: #ccc;
            opacity: 1;
        }

        /* Remaining days — faint filled ghost */
        .day.remaining {
            background: #141414;
        }

        .day.remaining:hover {
            background: #2a2a2a;
        }

        /* The day the father died — pitch black void */
        .day.loss {
            background: #000000;
        }

        .day.loss:hover {
            background: #000000;
        }

        /* Father's life marker — solemn red */
        .day.father {
            background: #7a1b1b;
        }

        .day.father:hover {
            background: #c0392b;
        }

        /* ============================
           Tooltip
           ============================ */

        /* ============================
           Footer — Pessoa quote
           ============================ */

        .poem {
            text-align: center;
            padding: 0 20px 60px;
            font-size: 0.65rem;
            color: #444;
            letter-spacing: 0.12em;
            line-height: 1.8;
        }

        .poem .separator {
            margin-bottom: 16px;
        }

        .poem-line {
            position: relative;
            display: block;
        }

        .poem-line .pt,
        .poem-line .en {
            transition: opacity 0.4s ease;
        }

        .poem-line .en {
            position: absolute;
            left: 0;
            right: 0;
            opacity: 0;
        }

        .poem:hover .poem-line .pt {
            opacity: 0;
        }

        .poem:hover .poem-line .en {
            opacity: 1;
        }

        .colophon {
            display: block;
            text-align: center;
            font-size: 0.6rem;
            color: #2a2a2a;
            letter-spacing: 0.2em;
            text-decoration: none;
            padding-bottom: 40px;
        }

        .colophon:hover {
            color: #444;
        }

        /* ============================
           Tooltip
           ============================ */

        .tooltip {
            position: fixed;
            background: #141414;
            color: #999;
            padding: 5px 12px;
            border-radius: 2px;
            font-size: 0.72rem;
            font-family: 'Times New Roman', serif;
            letter-spacing: 0.08em;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.12s ease;
            z-index: 1000;
            border: 1px solid #222;
            white-space: nowrap;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .tooltip.memento {
            color: #c0392b;
        }
    </style>
</head>
<body>

    <header class="info-panel">
        <div class="clock" id="clock"></div>
    </header>

    <section class="grid-section">
        <div class="grid" id="grid"></div>
    </section>

    <footer class="poem">
        <div class="separator"></div>
        <p class="poem-line">
            <span class="pt">Tem só duas datas — a da minha nascença e a da minha morte.</span>
            <span class="en">I have only two dates — that of my birth and that of my death.</span>
        </p>
        <p class="poem-line">
            <span class="pt">Entre uma e outra cousa todos os dias são meus.</span>
            <span class="en">Between one and the other, all the days are mine.</span>
        </p>
    </footer>

    <a class="colophon" href="https://github.com/macakuaya/MementoMori#readme" target="_blank">memento mori</a>

    <div class="tooltip" id="tooltip"></div>

    <script>
    (() => {
        // ==========================================
        //  Constants
        // ==========================================
        const BIRTH        = new Date(1990, 10, 2);   // 2 November 1990
        const FATHER_BIRTH = new Date(1959, 5, 25);   // 25 June 1959
        const FATHER_DEATH = new Date(2001, 11, 6);   // 6 December 2001
        const LIFE_EXP     = 84.01;                    // Spain life expectancy (2024)
        const TOTAL_DAYS   = Math.round(LIFE_EXP * 365.25);

        // ==========================================
        //  Helpers
        // ==========================================
        const daysBetween = (a, b) => Math.floor((b - a) / 864e5);

        const dayToAge = (i) => {
            const d = new Date(BIRTH);
            d.setDate(d.getDate() + i);

            let y  = d.getFullYear() - BIRTH.getFullYear();
            let m  = d.getMonth()    - BIRTH.getMonth();
            let dd = d.getDate()     - BIRTH.getDate();

            if (dd < 0) {
                m--;
                dd += new Date(d.getFullYear(), d.getMonth(), 0).getDate();
            }
            if (m < 0) {
                y--;
                m += 12;
            }

            return `${y} years, ${m} months, ${dd} days`;
        };

        const fmtDate = (d) =>
            `${d.getDate()}/${d.getMonth() + 1}/${d.getFullYear()}`;

        const pad = (n) => String(n).padStart(2, '0');

        const commas = (n) => n.toLocaleString('en');

        // ==========================================
        //  Computed values
        // ==========================================
        const now          = new Date();
        const daysLived    = daysBetween(BIRTH, now);
        const fatherDays   = daysBetween(FATHER_BIRTH, FATHER_DEATH);
        const lossDay      = daysBetween(BIRTH, FATHER_DEATH); // the day he died, in our timeline

        // ==========================================
        //  Live clock — hours, minutes, seconds / days
        // ==========================================
        const clockEl = document.getElementById('clock');
        let showDays = false;

        clockEl.style.cursor = 'pointer';
        clockEl.addEventListener('click', () => {
            showDays = !showDays;
            tick();
        });

        const tick = () => {
            const ms  = Date.now() - BIRTH.getTime();

            if (showDays) {
                const days = Math.floor(ms / 864e5);
                clockEl.innerHTML =
                    `<span class="value">${commas(days)}</span><span class="unit">days</span>`;
            } else {
                const sec = Math.floor(ms / 1000);
                const min = Math.floor(sec / 60);
                const hrs = Math.floor(min / 60);
                clockEl.innerHTML =
                    `<span class="value">${commas(hrs)}</span><span class="unit">hrs</span>` +
                    `<span class="value">${pad(min % 60)}</span><span class="unit">min</span>` +
                    `<span class="value">${pad(sec % 60)}</span><span class="unit">sec</span>`;
            }
        };

        tick();
        setInterval(tick, 1000);

        // ==========================================
        //  Grid rendering
        // ==========================================
        const grid = document.getElementById('grid');
        const frag = document.createDocumentFragment();

        for (let i = 0; i < TOTAL_DAYS; i++) {
            const el = document.createElement('div');

            if (i === lossDay) {
                el.className = 'day loss';
            } else if (i === fatherDays) {
                el.className = 'day father';
            } else if (i < daysLived) {
                el.className = 'day lived';
            } else {
                el.className = 'day remaining';
            }

            el.dataset.i = i;
            frag.appendChild(el);
        }

        grid.appendChild(frag);

        // ==========================================
        //  Tooltip — event delegation
        // ==========================================
        const tip = document.getElementById('tooltip');
        let mementoTimer = null;

        grid.addEventListener('mouseover', (e) => {
            const sq = e.target;
            if (!sq.dataset.i) return;

            const idx = +sq.dataset.i;

            tip.textContent = dayToAge(idx);
            tip.className = sq.classList.contains('father')
                ? 'tooltip visible memento'
                : 'tooltip visible';

            clearTimeout(mementoTimer);
            if (sq.classList.contains('father')) {
                mementoTimer = setTimeout(() => {
                    tip.textContent = 'MEMENTO MORI';
                }, 3000);
            }
        });

        grid.addEventListener('mousemove', (e) => {
            tip.style.left = `${e.clientX + 14}px`;
            tip.style.top  = `${e.clientY - 32}px`;
        });

        grid.addEventListener('mouseout', (e) => {
            if (e.target.dataset.i !== undefined) {
                tip.className = 'tooltip';
                clearTimeout(mementoTimer);
            }
        });
    })();
    </script>

</body>
</html>
